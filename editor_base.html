<!doctype html>
<html>
<head>
	<title> </title>
	<meta http-equiv="X-UA-Compatible" content="IE=9"> 
	<meta charset="utf-8" />
<style>
.editBtn{padding:5px;}
#editBox{height:200px;width:400px;border:1px solid blue;}
</style>
<script src="http://code.jquery.com/jquery-1.7.2.min.js"></script>
<script type="text/javascript">
var selectedRange;
$(function() {
	editBtnBind();
	selectionSaveBind();
});
function editBtnBind(){
	$(".editBtn").on('click',function (e){
		if($(this).hasClass("bold")) bold();
		if($(this).hasClass("insert")) insert();	
		if($(this).hasClass("replace")) replace();			
	});
}

function bold(){
	restoreSelection();
	document.execCommand('bold');
	saveSelection();
}

function insert(){
	restoreSelection();
	var aa=document.createElement("span");
	aa.innerHTML="<i style='color:red;'>呵了个呵</i>";
	selectedRange.insertNode(aa);//这个插入成功后 光标会显示在node的最前
	window.getSelection().collapse(aa, aa.childNodes.length);//光标移到node最后
	saveSelection();	
}
function replace(){
	restoreSelection();
	var fragment=selectedRange.extractContents();		
	var aa=document.createElement("span");
	aa.innerHTML="<i style='color:red;'>呵了个呵</i>";
	selectedRange.insertNode(aa);
	//window.getSelection().extend(aa,1); //ie9没有此方法
	window.getSelection().selectAllChildren(aa);
	saveSelection();	
}




function selectionSaveBind(){
	$("div[contenteditable=true]").on('mouseleave',function () {
		if (this!=document.activeElement) return false;
		saveSelection();
	})
}
function saveSelection(){
	selectedRange = getCurrentRange();
	console.log(selectedRange);
}
function  getCurrentRange() {
	var sel = window.getSelection();
	if (sel.getRangeAt && sel.rangeCount) {
		return sel.getRangeAt(0);
	}
}
function restoreSelection() {
	var selection = window.getSelection();
	selection.removeAllRanges();
	selection.addRange(selectedRange);
}
</script>
</head>

<body>
	<button class="editBtn bold">加粗</button>
	<button class="editBtn insert">html插入</button>
	<button class="editBtn replace">html替换</button>	

<div id="editBox" contenteditable="true">
	此处输入文字...
</div>
<div style="position:absolute;top:5px;left:420px;">
<pre>
插入和替换选区里的html，还有更好的实现方法么？	（使用标准Selection和Range操作，要兼容IE9）
function insert(){
	restoreSelection();
	var aa=document.createElement("span");
	aa.innerHTML="<i style='color:red;'>呵了个呵</i>";
	selectedRange.insertNode(aa);//这个插入成功后 光标会显示在node的最前
	window.getSelection().collapse(aa, aa.childNodes.length);//光标移到node最后
	saveSelection();	
}
function replace(){
	restoreSelection();
	var fragment=selectedRange.extractContents();		
	var aa=document.createElement("span");
	aa.innerHTML="<i style='color:red;'>呵了个呵</i>";
	selectedRange.insertNode(aa);
	//window.getSelection().extend(aa,1); //ie9没有此方法
	window.getSelection().selectAllChildren(aa);
	saveSelection();	
}
具体实现，请查看源码。加q交流 1140215489
</pre>
</div>
contenteditable="true" editor

</body>
</html>
